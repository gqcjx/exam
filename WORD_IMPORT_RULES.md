# Word 文档导入规则（教师用卷/学生用卷）

## 概述

本系统支持从 Word 文档中导入试题数据，支持两种文档格式：
- **教师用卷.docx**：包含题目、答案和解析的完整版本
- **学生用卷.docx**：仅包含题目的版本（用于生成试卷）

系统会优先从教师用卷中提取答案和解析，如果只有学生用卷，则仅导入题目内容。

## 文档结构识别

### 1. 大题分类标识

支持以下大题分类格式：

```
一、单选题：本大题共1小题，共2分。
二、填空题：本大题共1小题，共4分。
三、默写：本大题共1小题，共10分。
四、名著阅读：本大题共1小题，共6分。
五、语言表达：本大题共1小题，共10分。
六、现代文阅读：本大题共1小题，共30分。
七、文言文阅读：本大题共1小题，共15分。
八、诗歌鉴赏：本大题共1小题，共10分。
```

**识别规则**：
- 中文数字（一、二、三...）+ "、" + 题型名称
- 题型名称后可以跟"："或"：本大题共X小题，共Y分。"
- 题型名称用于自动识别题目类型

### 2. 题目编号格式

支持以下题目编号格式：

```
1. 题目内容
1、题目内容
1) 题目内容
1）题目内容
第1题 题目内容
(1) 题目内容（子题编号）
【小题1】题目内容
```

**识别规则**：
- 阿拉伯数字 + 标点符号（.、、)、））
- "第" + 数字 + "题"
- 括号内的数字（用于子题）
- 【小题X】格式（用于复合题的子题）

### 3. 题型自动识别

根据大题分类或题目特征自动识别题型：

| 大题类型 | 识别为题型 | 说明 |
|---------|----------|------|
| 单选题 | `single` | 有选项，单个答案 |
| 多选题 | `multiple` | 有选项，多个答案（用逗号分隔） |
| 判断题 | `true_false` | 正确/错误选项 |
| 填空题 | `fill` | 包含 `____` 或 `（　　）` |
| 默写 | `fill` | 包含 `________________` |
| 简答题 | `short` | 无选项，需要文字回答 |
| 语言表达 | `short` | 无选项，需要文字回答 |
| 阅读理解 | `short` | 包含阅读材料和多道子题 |
| 文言文阅读 | `short` | 包含文言文材料和多道子题 |
| 诗歌鉴赏 | `short` | 包含诗歌材料和多道子题 |

## 选项格式

### 标准选项格式

```
A. 选项内容
B. 选项内容
C. 选项内容
D. 选项内容
```

### 支持的选项格式变体

```
A. 选项内容
A、选项内容
A) 选项内容
A）选项内容
A：选项内容
A 选项内容（空格分隔）
(A) 选项内容
```

**识别规则**：
- 选项字母：A-H（大写）
- 选项标识符：.、、、)、）、：、空格
- 选项内容：标识符后的所有文本（可跨行）

### 特殊选项格式

**填空题选项**：
```
A.颜色 B.气象
```
识别为两个独立选项，用于填空题的选择填空。

## 答案格式

### 标准答案格式

```
【答案】B
【答案】①B ②A
【答案】【小题1】明　吴承恩
【答案】【小题2】孙悟空偷吃人参果
【答案】【小题3】表现了猪八戒贪吃、急躁的性格特点。
```

### 支持的答案格式变体

```
答案：A
答案：A,B
正确答案：A
参考答案：A,B,C
标准答案：A
答案 A（无冒号）
【答案】正确
【答案】错误
【答案】①B ②A（多个填空）
```

### 复合题答案格式

对于包含多个子题的题目（如阅读理解），答案格式为：

```
【答案】【小题1】A
【答案】【小题2】成功者实现了人生的价值；失败者从失败中吸取教训，汲取力量，成为生活的强者。
【答案】【小题3】从"为什么要奋斗""怎样奋斗""为谁奋斗"三个层面展开了论证。
```

**识别规则**：
- `【答案】` 或 `答案：` 开头
- 子题答案用 `【小题X】` 标识
- 多个填空答案用 `①X ②Y` 格式
- 判断题答案：正确/错误/对/错/T/F

## 解析格式

### 标准解析格式

```
【解析】本题考查对主旨的分析能力。解答此题，注意结合文段内容，抓住文章主要内容分析人物形象，提炼答案。
白求恩有一次在为伤员实施急救手术时受感染，1939年11月12日在河北唐县不幸逝世；他在生命的最后时刻，仍怀着崇敬的心情，想念着毛泽东。...
```

### 支持的解析格式变体

```
解析：这是解析内容
详解：这是解析内容
说明：这是解析内容
解答：这是解析内容
答案解析：这是解析内容
题目解析：这是解析内容
【解析】这是解析内容（多行）
```

**识别规则**：
- `【解析】` 或 `解析：` 开头
- 解析内容可以跨多行
- 解析结束于下一题开始或文档结束

### 复合题解析格式

对于包含多个子题的题目，解析格式为：

```
【解析】（1）该段叙述了孙悟空在五庄观偷吃人参果的故事，节选自《西游记》，作者为明代吴承恩。
（2）该段叙述时孙悟空在五庄观偷吃人参果的故事，根据文段内容可以概括出题目。
（3）本道题考查学生对《西游记》有关情节的掌握和分析能力。
```

**识别规则**：
- 子题解析用 `（1）`、`（2）`、`（3）` 标识
- 或者用 `【小题1】`、`【小题2】` 标识
- 解析内容可以跨多行

## 题目内容提取规则

### 1. 题干提取

- 从题目编号后开始，到选项或答案前结束
- 题干可以跨多行
- 保留题干中的所有格式（换行、空格等）

### 2. 阅读材料提取

对于阅读理解、文言文阅读、诗歌鉴赏等题型：

```
6.阅读下面的文字，完成各题。 
奋斗，成功者的"通行证"
徐文秀
ㅤㅤ①"前进的道路从不会一帆风顺，实现中华民族伟大复兴的中国梦需要一代一代青年矢志奋斗。"...
```

**识别规则**：
- 阅读材料在题干之后、子题之前
- 阅读材料可以跨多行
- 阅读材料应包含在题干中，或作为题目的附加内容

### 3. 子题提取

对于包含多个子题的题目：

```
(1) 下列对文章内容的理解与分析，正确的一项是 ______ 
A.第②段用良训和鲁迅的名言论证了"踏踏实实、努力奋斗才是成功的秘诀所在"的观点。 
B.一个人只要愿意奋斗，就会永远立于不败之地。 
C.所有的成功都离不开奋斗，埋头苦干是增强奋斗本领的唯一方法。 
D.我们把为长远做打算，为他人谋幸福作为奋斗目标，只有这样的奋斗才有意义。
(2) 奋斗精神有什么意义？请简要概括。
(3) 文章围绕"奋斗，成功者的'通行证'"的观点，从哪三个层面展开了论证？
```

**识别规则**：
- 子题编号：`(1)`、`(2)`、`(3)` 或 `【小题1】`、`【小题2】`、`【小题3】`
- 每个子题可以独立成题，也可以作为复合题的一部分
- 子题可以有自己的选项、答案和解析

## 完整示例

### 示例1：单选题（教师用卷）

```
一、单选题：本大题共1小题，共2分。
1.本文赞扬了白求恩同志的四种精神，下列理解正确的一项是（　　）
A. 文章主要赞扬的是白求恩的国际主义精神。
B. 文章主要赞扬的是白求恩的共产主义精神，其他精神是共产主义精神的具体表现。
C. 文章赞扬白求恩的四种精神都是极其重要的，它们没有主次之分。
D. 文章主要赞扬的是白求恩的国际主义精神，一个人具有国际主义精神，才算是具有共产主义精神。
【答案】B
【解析】本题考查对主旨的分析能力。解答此题，注意结合文段内容，抓住文章主要内容分析人物形象，提炼答案。
白求恩有一次在为伤员实施急救手术时受感染，1939年11月12日在河北唐县不幸逝世；他在生命的最后时刻，仍怀着崇敬的心情，想念着毛泽东。...
```

**解析结果**：
```json
{
  "type": "single",
  "stem": "本文赞扬了白求恩同志的四种精神，下列理解正确的一项是（　　）",
  "options": [
    { "label": "A", "text": "文章主要赞扬的是白求恩的国际主义精神。" },
    { "label": "B", "text": "文章主要赞扬的是白求恩的共产主义精神，其他精神是共产主义精神的具体表现。" },
    { "label": "C", "text": "文章赞扬白求恩的四种精神都是极其重要的，它们没有主次之分。" },
    { "label": "D", "text": "文章主要赞扬的是白求恩的国际主义精神，一个人具有国际主义精神，才算是具有共产主义精神。" }
  ],
  "answer": ["B"],
  "analysis": "本题考查对主旨的分析能力。解答此题，注意结合文段内容，抓住文章主要内容分析人物形象，提炼答案。\n白求恩有一次在为伤员实施急救手术时受感染，1939年11月12日在河北唐县不幸逝世；他在生命的最后时刻，仍怀着崇敬的心情，想念着毛泽东。..."
}
```

### 示例2：填空题（教师用卷）

```
二、填空题：本大题共1小题，共4分。
2.请根据上下文选择恰当的选项填空。
当年南开校门侧,曾悬一大镜,镜旁镌有箴词曰:"面必净,发必理,衣必整,纽必结。头容正,肩容平,胸容宽,背容直。①____:勿傲、勿暴、勿怠。②____:宜和、宜静、宜庄。"学生出入,知所警诫。 
A.颜色 B.气象
【答案】①B ②A
【解析】此题考查学生词语的辨析运用能力。解题时，要注意理解词语的含义，了解其情感色彩。结合语境来判断其运用是否得当。...
```

**解析结果**：
```json
{
  "type": "fill",
  "stem": "请根据上下文选择恰当的选项填空。\n当年南开校门侧,曾悬一大镜,镜旁镌有箴词曰:\"面必净,发必理,衣必整,纽必结。头容正,肩容平,胸容宽,背容直。①____:勿傲、勿暴、勿怠。②____:宜和、宜静、宜庄。\"学生出入,知所警诫。",
  "options": [
    { "label": "A", "text": "颜色" },
    { "label": "B", "text": "气象" }
  ],
  "answer": ["①B", "②A"],
  "analysis": "此题考查学生词语的辨析运用能力。解题时，要注意理解词语的含义，了解其情感色彩。结合语境来判断其运用是否得当。..."
}
```

### 示例3：简答题/默写（教师用卷）

```
三、默写：本大题共1小题，共10分。
3."舍生而取义""杀身以成仁"是古代志士仁人推崇的一种生死观，课文中的"________________"就是对这种生死观的真情表白。
【答案】​取义成仁今日事
【解析】本题考查学生对诗文的背诵、理解、默写能力。诗词在背诵时不仅要注重读音，更要注意容易写错的字，填写名句漏填和错填均不得分，一些易错字可结合词义去背诵。...
```

**解析结果**：
```json
{
  "type": "fill",
  "stem": "\"舍生而取义\"\"杀身以成仁\"是古代志士仁人推崇的一种生死观，课文中的\"________________\"就是对这种生死观的真情表白。",
  "options": null,
  "answer": ["取义成仁今日事"],
  "analysis": "本题考查学生对诗文的背诵、理解、默写能力。诗词在背诵时不仅要注重读音，更要注意容易写错的字，填写名句漏填和错填均不得分，一些易错字可结合词义去背诵。..."
}
```

### 示例4：复合题（阅读理解，教师用卷）

```
六、现代文阅读：本大题共1小题，共30分。
6.阅读下面的文字，完成各题。 
奋斗，成功者的"通行证"
徐文秀
ㅤㅤ①"前进的道路从不会一帆风顺，实现中华民族伟大复兴的中国梦需要一代一代青年矢志奋斗。"...
(1) 下列对文章内容的理解与分析，正确的一项是 ______ 
A.第②段用良训和鲁迅的名言论证了"踏踏实实、努力奋斗才是成功的秘诀所在"的观点。 
B.一个人只要愿意奋斗，就会永远立于不败之地。 
C.所有的成功都离不开奋斗，埋头苦干是增强奋斗本领的唯一方法。 
D.我们把为长远做打算，为他人谋幸福作为奋斗目标，只有这样的奋斗才有意义。
(2) 奋斗精神有什么意义？请简要概括。
(3) 文章围绕"奋斗，成功者的'通行证'"的观点，从哪三个层面展开了论证？
【答案】【小题1】A
【答案】【小题2】成功者实现了人生的价值；失败者从失败中吸取教训，汲取力量，成为生活的强者。
【答案】【小题3】从"为什么要奋斗""怎样奋斗""为谁奋斗"三个层面展开了论证。
【解析】（1）本题考查文章内容理解分析。A.正确；B.有误，从第③段中"奋斗会有成功，也会有失败，无论成功还是失败都有意义"可知...（2）本题考查文章内容的理解与概括。根据"奋斗精神就是吃苦受累、敢闯敢试的精神..."可得：成功者实现了人生的价值；失败者从失败中吸取教训，汲取力量，成为生活的强者。（3）本题考查文章内容的理解。文章标题作为中心论点，第②③段从"事业是实干出来的，幸福是奋斗出来的"论述了"为什么奋斗"；第④段从"提高奋斗本领对奋斗本身而言至关重要"这一方面论述了"怎样奋斗"；第⑤段"那么，我们要为谁而奋斗呢"，论述了"为谁奋斗"，文章从这三个层面展开论证。
```

**解析结果**（拆分为多个题目）：

**题目1**：
```json
{
  "type": "single",
  "stem": "阅读下面的文字，完成各题。\n奋斗，成功者的\"通行证\"\n徐文秀\nㅤㅤ①\"前进的道路从不会一帆风顺，实现中华民族伟大复兴的中国梦需要一代一代青年矢志奋斗。\"...\n(1) 下列对文章内容的理解与分析，正确的一项是 ______",
  "options": [
    { "label": "A", "text": "第②段用良训和鲁迅的名言论证了\"踏踏实实、努力奋斗才是成功的秘诀所在\"的观点。" },
    { "label": "B", "text": "一个人只要愿意奋斗，就会永远立于不败之地。" },
    { "label": "C", "text": "所有的成功都离不开奋斗，埋头苦干是增强奋斗本领的唯一方法。" },
    { "label": "D", "text": "我们把为长远做打算，为他人谋幸福作为奋斗目标，只有这样的奋斗才有意义。" }
  ],
  "answer": ["A"],
  "analysis": "本题考查文章内容理解分析。A.正确；B.有误，从第③段中\"奋斗会有成功，也会有失败，无论成功还是失败都有意义\"可知..."
}
```

**题目2**：
```json
{
  "type": "short",
  "stem": "阅读下面的文字，完成各题。\n奋斗，成功者的\"通行证\"\n徐文秀\nㅤㅤ①\"前进的道路从不会一帆风顺，实现中华民族伟大复兴的中国梦需要一代一代青年矢志奋斗。\"...\n(2) 奋斗精神有什么意义？请简要概括。",
  "options": null,
  "answer": ["成功者实现了人生的价值；失败者从失败中吸取教训，汲取力量，成为生活的强者。"],
  "analysis": "本题考查文章内容的理解与概括。根据\"奋斗精神就是吃苦受累、敢闯敢试的精神...\"可得：成功者实现了人生的价值；失败者从失败中吸取教训，汲取力量，成为生活的强者。"
}
```

**题目3**：
```json
{
  "type": "short",
  "stem": "阅读下面的文字，完成各题。\n奋斗，成功者的\"通行证\"\n徐文秀\nㅤㅤ①\"前进的道路从不会一帆风顺，实现中华民族伟大复兴的中国梦需要一代一代青年矢志奋斗。\"...\n(3) 文章围绕\"奋斗，成功者的'通行证'\"的观点，从哪三个层面展开了论证？",
  "options": null,
  "answer": ["从\"为什么要奋斗\"\"怎样奋斗\"\"为谁奋斗\"三个层面展开了论证。"],
  "analysis": "本题考查文章内容的理解。文章标题作为中心论点，第②③段从\"事业是实干出来的，幸福是奋斗出来的\"论述了\"为什么奋斗\"；第④段从\"提高奋斗本领对奋斗本身而言至关重要\"这一方面论述了\"怎样奋斗\"；第⑤段\"那么，我们要为谁而奋斗呢\"，论述了\"为谁奋斗\"，文章从这三个层面展开论证。"
}
```

## 学生用卷处理规则

### 学生用卷特点

学生用卷不包含答案和解析，仅包含题目内容：

```
一、单选题：本大题共1小题，共2分。
1.本文赞扬了白求恩同志的四种精神，下列理解正确的一项是（　　）
A. 文章主要赞扬的是白求恩的国际主义精神。
B. 文章主要赞扬的是白求恩的共产主义精神，其他精神是共产主义精神的具体表现。
C. 文章赞扬白求恩的四种精神都是极其重要的，它们没有主次之分。
D. 文章主要赞扬的是白求恩的国际主义精神，一个人具有国际主义精神，才算是具有共产主义精神。
```

**处理规则**：
- 提取题目内容、选项
- 答案字段为空数组 `[]`
- 解析字段为 `null`
- 可以用于生成试卷，但不适合导入题库（缺少答案）

## 导入优先级

1. **优先使用教师用卷**：如果同时存在教师用卷和学生用卷，优先从教师用卷中提取答案和解析
2. **学生用卷作为补充**：如果只有学生用卷，可以提取题目内容，但需要手动补充答案和解析

## 数据验证规则

### 必填字段

- `stem`（题干）：不能为空
- `type`（题型）：必须为 `single`、`multiple`、`true_false`、`fill`、`short` 之一
- `answer`（答案）：选择题和判断题不能为空

### 可选字段

- `options`（选项）：填空题和简答题可以为 `null`
- `analysis`（解析）：可以为 `null`
- `subject`（学科）：默认为"未分类"
- `grade`（年级）：可以为 `null`
- `difficulty`（难度）：默认为 1
- `tags`（标签）：默认为空数组

### 数据清理

- 去除题干、选项、答案、解析中的首尾空白
- 规范化选项标签为大写字母（A-Z）
- 规范化答案格式（去除空格，统一大小写）
- 处理多行文本中的换行符

## 错误处理

### 常见错误及处理

1. **题目编号格式错误**
   - 错误：无法识别题目开始
   - 处理：跳过该题目，记录警告

2. **选项格式错误**
   - 错误：选项标识符不标准
   - 处理：尝试多种格式匹配，如果都失败则跳过该选项

3. **答案格式错误**
   - 错误：无法识别答案
   - 处理：如果是从教师用卷导入，记录错误；如果是从学生用卷导入，答案为空

4. **解析格式错误**
   - 错误：无法识别解析
   - 处理：解析字段设为 `null`，不影响题目导入

5. **复合题拆分错误**
   - 错误：无法正确拆分复合题
   - 处理：将整个复合题作为一道简答题导入

## 使用建议

### 最佳实践

1. **使用教师用卷**：优先使用包含答案和解析的教师用卷
2. **格式统一**：在同一文档中使用统一的格式
3. **题目编号**：确保每道题都有明确的编号
4. **答案标注**：确保答案格式清晰，使用 `【答案】` 或 `答案：` 标识
5. **解析标注**：确保解析格式清晰，使用 `【解析】` 或 `解析：` 标识

### 注意事项

1. **图片支持**：当前版本不支持图片提取，需要在导入后手动添加
2. **表格支持**：复杂表格格式可能无法正确解析
3. **公式支持**：数学公式可能无法完美保留格式
4. **富文本**：部分 Word 格式（如颜色、字体）可能丢失
5. **复合题**：阅读理解等复合题会被拆分为多个独立题目

## 技术实现

### 解析流程

1. **文档读取**：使用 `mammoth` 库提取 Word 文档文本
2. **行级解析**：逐行分析，识别大题分类、题目编号、选项、答案、解析
3. **状态管理**：使用状态机管理解析状态
4. **题目组装**：将解析的元素组装成完整的题目对象
5. **数据验证**：验证题目数据的完整性和正确性
6. **格式转换**：转换为数据库格式

### 关键函数

- `parseWordDocument()`: 主解析函数
- `detectQuestionType()`: 检测题目类型
- `extractStem()`: 提取题干
- `extractOptions()`: 提取选项
- `extractAnswer()`: 提取答案
- `extractAnalysis()`: 提取解析
- `normalizeQuestion()`: 规范化题目数据

## 更新日志

### v1.0 (当前版本)
- ✅ 支持教师用卷和学生用卷两种格式
- ✅ 支持大题分类识别
- ✅ 支持多种题目编号格式
- ✅ 支持多种选项格式
- ✅ 支持多种答案格式（包括复合题答案）
- ✅ 支持多种解析格式（包括复合题解析）
- ✅ 支持复合题拆分
- ✅ 自动识别题目类型
- ✅ 数据验证和清理

## 相关文档

- [Word 导入格式说明](./WORD_IMPORT_FORMAT.md)
- [Edge Function 部署指南](./DEPLOY_EDGE_FUNCTION.md)
- [数据库 Schema](../supabase/schema.sql)



